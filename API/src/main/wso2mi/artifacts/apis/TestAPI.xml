<api xmlns="http://ws.apache.org/ns/synapse" name="TestAPI" context="/testapi">
    <resource methods="POST">
        <inSequence>
            <property name="messageType" value="application/json" scope="axis2"/>
            <property name="NO_ENTITY_BODY" scope="axis2" action="remove"/>

            <property name="init" scope="default" type="STRING" value="false"/>

            <property name="accum" scope="default" type="STRING" expression="json-eval($)"/>

            <property name="incomingPayload" scope="default" expression="json-eval($)" />

            <log>
                <property name="DEBUG_incomingPayload (raw)" expression="get-property('incomingPayload')" />
            <log>

            <log>
                <property name="DEBUG_incomingPayload (raw2)" expression="json-eval(get-property('incomingPayload'))" />
            <log>

            <payloadFactory media-type="json" template-type="freemarker">
    <format><![CDATA[
        {
            "accum": [
                <#if ctx.incomingPayload?? && ctx.incomingPayload?is_sequence>
                    <#list ctx.incomingPayload as item>
                        ${item}
                        <#if item_has_next>,</#if>
                    </#list>
                </#if>
            ]
        }
    ]]></format>
    <args/>
</payloadFactory>
            <respond/>
        </inSequence>
    </resource>
</api>
