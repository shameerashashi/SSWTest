<api xmlns="http://ws.apache.org/ns/synapse" name="TestAPI" context="/testapi">
    <resource methods="POST">
        <inSequence>
            <!-- Capture incoming JSON payload -->
            <property name="incomingPayload" scope="default" expression="json-eval($)" type="OM"/>

            <!-- Define additional JSON elements -->
            <property name="extraCourses" scope="default" type="OM">
                <jsonArray>
                    <jsonElement>
                        <id>3</id>
                        <name>New Course</name>
                    </jsonElement>
                    <jsonElement>
                        <id>4</id>
                        <name>Another Course</name>
                    </jsonElement>
                </jsonArray>
            </property>

            <!-- Merge both JSON arrays and format response -->
            <payloadFactory media-type="json" template-type="freemarker">
                <format><![CDATA[
                    {
                        "courses": [
                            <#list ctx.incomingPayload + ctx.extraCourses as item>
                                ${item}
                                <#if item_has_next>,</#if>
                            </#list>
                        ]
                    }
                ]]></format>
                <args/>
            </payloadFactory>

            <respond/>
        </inSequence>
    </resource>
</api>
