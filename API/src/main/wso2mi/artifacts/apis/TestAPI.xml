<api xmlns="http://ws.apache.org/ns/synapse" name="TestAPI" context="/testapi">
    <resource methods="POST">
        <inSequence>
            <!-- Ensure JSON message format -->
            <property name="messageType" value="application/json" scope="axis2"/>
            <property name="NO_ENTITY_BODY" scope="axis2" action="remove"/>

            <!-- Store incoming JSON array -->
            <property name="tutoringCampaignData" scope="default" expression="json-eval($)" type="JSON"/>

            <payloadFactory media-type="json">
                <format>            
                    [
   {
      "StudentUsername":"Kola",
      "StudentFirstName":"D00653246",
      "StudentEmail":"kadeeyojr@gmail.com"
   },
   {
      "StudentUsername":"Timothy",
      "StudentFirstName":"D00666502",
      "StudentEmail":"timothy_michael_smith@yahoo.com"
   }
]            
                </format>
                <args/>
            </payloadFactory>

            <property name="tutorData" scope="default" expression="json-eval($)" type="JSON"/>

            <log level="custom">
                <property name="tutoringCampaignData" expression="$ctx:tutoringCampaignData"/>
                <property name="tutorData" expression="$ctx:tutorData"/>
            </log>


            <foreach id="foreach_1" expression="json-eval($ctx:tutoringCampaignData.items)">
                    <sequence>
                        <property name="tutoringCampaignData" scope="default" expression="json-eval($.values.canvas_student_first_name)" type="JSON"/>
                    </sequence>
            </foreach>
            
            
            <respond/>
        </inSequence>
    </resource>
</api>
