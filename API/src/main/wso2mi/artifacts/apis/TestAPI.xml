<api xmlns="http://ws.apache.org/ns/synapse" name="TestAPI" context="/testapi">
<resource methods="POST">
        <inSequence>
            <!-- Ensure JSON message format -->
            <property name="messageType" value="application/json" scope="axis2"/>
            <property name="NO_ENTITY_BODY" scope="axis2" action="remove"/>

            <!-- Store incoming JSON array -->
            <property name="originalPayload" scope="default" expression="json-eval($)" type="JSON"/>

            <!-- Duplicate input array to 'extraCourses' -->
            <property name="extraCourses" scope="default" expression="json-eval($)" type="JSON"/>

            <payloadFactory media-type="json" template-type="freemarker">
                <format><![CDATA[
                    {
                        "accum": [
                            <#list ctx.originalPayload as item>
                                ${item}<#if item_has_next>,</#if>
                            </#list>,
                            <#list ctx.extraCourses as item>
                                ${item}<#if item_has_next>,</#if>
                            </#list>
                        ]
                    }
                ]]></format>
                <args/>
            </payloadFactory>
            <respond/>
        </inSequence>
    </resource>
</api>
